# Claude Automation System - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆçŠ¶æ³

## ğŸ“‹ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦
GitHub Issueã§@claudeãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ã‚’æ¤œçŸ¥ã—ã€è‡ªå‹•çš„ã«Claude CLIã§ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ 

### ãƒªãƒã‚¸ãƒˆãƒª
- **URL**: https://github.com/worldscandy/claude-automation
- **ç¾åœ¨ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: Container Orchestration Systemå®Œå…¨å®Ÿè£…æ¸ˆã¿ âœ…

## ğŸ¯ Claude Codeé–‹ç™ºãƒãƒ¼ãƒ ã¸ã®ãŠé¡˜ã„

### åŸºæœ¬æ–¹é‡
- **å›ç­”è¨€èª**: æ—¥æœ¬èªã§ãŠé¡˜ã„ã—ã¾ã™
- **é–‹ç™ºã‚¹ã‚¿ã‚¤ãƒ«**: æ®µéšçš„ãªå®Ÿè£…ã¨ãƒ†ã‚¹ãƒˆã‚’é‡è¦–
- **å“è³ªç®¡ç†**: ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³å“è³ªã®ã‚³ãƒ¼ãƒ‰ä½œæˆ

### é‡è¦ãªé–‹ç™ºã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

#### ğŸ“‹ **è¦ä»¶é”æˆç¢ºèªãƒ—ãƒ­ã‚»ã‚¹**
- **CLAUDE.mdã«é”æˆæ„Ÿã‚’è¨˜éŒ²ã™ã‚‹å‰**: å¿…ãšIssueã®é–‹å§‹éƒ¨åˆ†ã«è¨˜è¼‰ã•ã‚ŒãŸå½“åˆè¦ä»¶ã‚’å†ç¢ºèª
- **ç¢ºèªé …ç›®**: 
  1. å½“åˆã®ç›®æ¨™ãƒ»å—å…¥åŸºæº–ãŒ100%é”æˆã•ã‚Œã¦ã„ã‚‹ã‹
  2. è¦ä»¶å¤‰æ›´ãŒã‚ã‚‹å ´åˆã€ãã®æ­£å½“æ€§ã¨ä»£æ›¿è§£æ±ºç­–ãŒé©åˆ‡ã‹
  3. ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ãŒæˆåŠŸã—ã¦ã„ã‚‹ã‹
- **ã‚³ãƒ³ãƒ†ãƒŠå†…Claudeå®Ÿè¡Œæ™‚**: ã“ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’å¿…ãšå®Ÿè¡Œã—ã€è¦ä»¶ç¢ºèªã‚’æ€ ã‚‰ãªã„
- **æ–‡æ›¸åŒ–**: è¦ä»¶å¤‰æ›´ã‚„ä»£æ›¿ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã®ç†ç”±ã‚’æ˜ç¢ºã«è¨˜éŒ²

#### ğŸ”„ ã‚³ãƒŸãƒƒãƒˆç®¡ç†
- **ã“ã¾ã‚ãªã‚³ãƒŸãƒƒãƒˆ**: æ©Ÿèƒ½å˜ä½ãƒ»ä¿®æ­£å˜ä½ã§ã®ã‚³ãƒŸãƒƒãƒˆå®Ÿè¡Œ
- **æ˜ç¢ºãªã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**: å¤‰æ›´å†…å®¹ã¨ç†ç”±ã‚’æ—¥æœ¬èªã§è¨˜è¼‰
- **Issueç•ªå·å¿…é ˆ**: ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«å¿…ãšIssueç•ªå·ã‚’è¨˜è¼‰ï¼ˆä¾‹: `feat: Docker Composeå®Ÿè£… (#9)` ã¾ãŸã¯ `fix: ãƒã‚°ä¿®æ­£ fixes #9`ï¼‰
- **ä½œæ¥­ãƒ–ãƒ©ãƒ³ãƒä½¿ç”¨**: main/masterãƒ–ãƒ©ãƒ³ãƒã¸ã®ç›´æ¥ã‚³ãƒŸãƒƒãƒˆç¦æ­¢
- **è‡ªå¾‹Claudeé©ç”¨**: Containerå†…ã®Claudeè‡ªå¾‹å‹•ä½œæ™‚ã‚‚åŒã˜é‹ç”¨æ–¹é‡ã‚’é©ç”¨
- **é€²æ—ã‚³ãƒ¡ãƒ³ãƒˆ**: é‡è¦ãªãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³æ™‚ã«Issueã¸é€²æ—ã‚³ãƒ¡ãƒ³ãƒˆæŠ•ç¨¿ï¼ˆä¸»è¦æ©Ÿèƒ½å®Œäº†ãƒ»ãƒ†ã‚¹ãƒˆçµæœãƒ»å•é¡Œè§£æ±ºãƒ»PRä½œæˆå‰ï¼‰

#### ğŸ§ª ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†ãƒ»é…ç½®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹
- **ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹**: ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®å®šæœŸçš„ãªè¦‹ç›´ã—ãƒ»æ›´æ–°
- **ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—**: ä¸è¦ãªãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ç©æ¥µçš„ãªå‰Šé™¤
- **æ¤œè¨¼**: ã‚·ã‚¹ãƒ†ãƒ ã§åˆ©ç”¨ã•ã‚Œã¦ã„ãªã„ãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèªãƒ»å‰Šé™¤
- **ã‚³ãƒŸãƒƒãƒˆå‰ãƒã‚§ãƒƒã‚¯**: PRä½œæˆå‰ã®å¿…é ˆã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ä½œæ¥­

##### ğŸ“‚ ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰é…ç½®è¦å‰‡
- **çµ±åˆãƒ†ã‚¹ãƒˆ**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã®`tests/integration/`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«é…ç½®
  - ä¾‹: `tests/integration/orchestrator/main.go`
  - è¤‡æ•°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ã¾ãŸãã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆç”¨
- **ãƒ¦ãƒ‹ãƒƒãƒˆãƒ»æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ**: å¯¾è±¡ã‚³ãƒ¼ãƒ‰ã¨åŒã˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã®`tests/`ã‚µãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«é…ç½®
  - ä¾‹: `cmd/agent/main.go` â†’ `cmd/agent/tests/test.go`
  - ä¾‹: `pkg/auth/generator.go` â†’ `pkg/auth/tests/generator_test.go`
  - æœ¬ç•ªã‚³ãƒ¼ãƒ‰ã¨ã®è¿‘æ¥æ€§ã§ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ€§å‘ä¸Š
- **å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰ä½¿ç”¨**: ãƒ†ã‚¹ãƒˆå†…ã§æœ¬ç•ªé–¢æ•°ãƒ»ã‚·ã‚¹ãƒ†ãƒ ã‚’ç›´æ¥ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨
  - ãƒ¢ãƒƒã‚¯ã‚ˆã‚Šå®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰å®Ÿè¡Œã§ã‚ˆã‚Šä¿¡é ¼æ€§ã®é«˜ã„ãƒ†ã‚¹ãƒˆ

##### ğŸ“‹ ãƒ†ã‚¹ãƒˆå®Ÿè£…ä¾‹
```
ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ :
claude-automation/
â”œâ”€â”€ tests/integration/           # çµ±åˆãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ orchestrator/
â”‚   â”œâ”€â”€ auth-k8s/
â”‚   â””â”€â”€ auth/
â”œâ”€â”€ cmd/
â”‚   â”œâ”€â”€ agent/
â”‚   â”‚   â”œâ”€â”€ main.go
â”‚   â”‚   â””â”€â”€ tests/             # agentã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
â”‚   â”‚       â””â”€â”€ agent_test.go
â”‚   â””â”€â”€ orchestrator/
â”‚       â”œâ”€â”€ main.go
â”‚       â””â”€â”€ tests/             # orchestratorã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
â”‚           â””â”€â”€ orchestrator_test.go
â””â”€â”€ pkg/
    â”œâ”€â”€ auth/
    â”‚   â”œâ”€â”€ generator.go
    â”‚   â”œâ”€â”€ monitor.go
    â”‚   â””â”€â”€ tests/             # authãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ†ã‚¹ãƒˆ
    â”‚       â”œâ”€â”€ generator_test.go
    â”‚       â””â”€â”€ monitor_test.go
    â””â”€â”€ kubernetes/
        â”œâ”€â”€ client.go
        â””â”€â”€ tests/             # kubernetesãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ†ã‚¹ãƒˆ
            â””â”€â”€ client_test.go
```

### Sub-issueç®¡ç†

#### Sub-issueä½œæˆæ–¹é‡
- **ã‚¿ã‚¤ãƒŸãƒ³ã‚°**:
  1. ã‚¿ã‚¹ã‚¯ãŒå¤§è¦æ¨¡åŒ–ã—ã€è¤‡æ•°ã®ç‹¬ç«‹ã—ãŸã‚µãƒ–ã‚¿ã‚¹ã‚¯ã«åˆ†å‰²ã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆ
  2. å½“åˆã®ã‚¿ã‚¹ã‚¯ã‚’é”æˆã™ã‚‹ãŸã‚ã«ã€åˆ¥ã®å•é¡Œã‚’å…ˆã«è§£æ±ºã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆ
  3. TDD (ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™º) ã«ãŠã‘ã‚‹ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹:
     - å¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’æ›¸ã„ãŸå¾Œã€ãã®ãƒ†ã‚¹ãƒˆã‚’é€šã™ãŸã‚ã®æœ€å°é™ã®å®Ÿè£…ã‚’è¡Œã†éš›
     - è¤‡é›‘ãªæ©Ÿèƒ½ã‚’æ®µéšçš„ã«å®Ÿè£…ã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆ
     - ä¾å­˜é–¢ä¿‚ã®é«˜ã„æ©Ÿèƒ½ã‚„ã€ä¸¦è¡Œã—ã¦é–‹ç™ºã§ãã‚‹è¦ç´ ãŒã‚ã‚‹å ´åˆ

#### ghã‚³ãƒãƒ³ãƒ‰ã§ã®Sub-issueè¿½åŠ æ–¹æ³•
```bash
# Sub-issueã®ä½œæˆã‚³ãƒãƒ³ãƒ‰
gh issue create \
  --title "Sub-issue: [è¦ªIssueã«é–¢é€£ã™ã‚‹ç°¡æ½”ãªèª¬æ˜]" \
  --body "## è¦ªIssue
[è¦ªIssueã®ãƒªãƒ³ã‚¯ã¾ãŸã¯ID]

## ç›®çš„
[ã“ã®Sub-issueã®å…·ä½“çš„ãªç›®çš„]

## ç¯„å›²
- [ ] ã‚¿ã‚¹ã‚¯1
- [ ] ã‚¿ã‚¹ã‚¯2

## å‚™è€ƒ
[è¿½åŠ ã®èª¬æ˜ã‚„æ³¨æ„ç‚¹]" \
  --milestone "[è¦ªIssueã®ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³]" \
  --label "sub-task" \
  --project "[ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå]"
```

#### GitHub Sub-issueã‚·ã‚¹ãƒ†ãƒ çµ±åˆ

##### GitHubå…¬å¼Sub-issueæ©Ÿèƒ½ä½¿ç”¨æ–¹æ³•
GitHub 2024å¹´å°å…¥ã®å…¬å¼Sub-issueæ©Ÿèƒ½ã‚’æ´»ç”¨ã€‚`addSubIssue` GraphQL mutationã‚’ä½¿ç”¨ï¼š

```bash
# Sub-issueã®è¦ªIssueé–¢ä¿‚ç™»éŒ²
gh api graphql --header "GraphQL-Features: sub_issues" --field query='
mutation {
  addSubIssue(input: {
    issueId: "I_kwDOOvl4EM64GCjh"     # è¦ªIssue ID (Issue #9)
    subIssueId: "I_kwDOOvl4EM64GLxx"  # Sub-issue ID (Issue #11)
  }) {
    issue { id number title }
    subIssue { id number title }
  }
}'
```

##### Issue IDå–å¾—æ–¹æ³•
```bash
# Issue IDã®ç¢ºèª
gh api graphql --field query='
query {
  repository(owner: "worldscandy", name: "claude-automation") {
    issues(first: 10, orderBy: {field: CREATED_AT, direction: DESC}) {
      nodes { id number title }
    }
  }
}'
```

#### ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†
- **ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤**: `.log`, `.tmp`, ãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ç­‰ã®é™¤å»
- **æ§‹é€ æœ€é©åŒ–**: ä¸è¦ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒ»è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®å‰Šé™¤
- **ä¾å­˜é–¢ä¿‚æ•´ç†**: æœªä½¿ç”¨ã®importãƒ»ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®é™¤å»

#### ğŸš€ minikubeç’°å¢ƒã§ã®é–‹ç™º
- **kubectlä½¿ç”¨æ–¹é‡**: minikubeç’°å¢ƒã§ã¯å¿…ãš`minikube kubectl --`ã‚’ä½¿ç”¨
- **ç†ç”±**: ã‚·ã‚¹ãƒ†ãƒ kubectl (v1.30.5) ã¨minikube kubectl (v1.33.1) ã§ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒç•°ãªã‚‹
- **ä¸€è²«æ€§ä¿è¨¼**: ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰ãƒ»Podç®¡ç†ã§minikubeå›ºæœ‰ã®æ©Ÿèƒ½ã¨ã®æ•´åˆæ€§ã‚’ç¶­æŒ
- **ã‚³ãƒãƒ³ãƒ‰ä¾‹**: 
  ```bash
  minikube kubectl -- get pods -n claude-automation
  minikube kubectl -- delete pod test-pod -n claude-automation
  minikube image load worldscandy/claude-automation:k8s
  ```

## âœ… ç¾åœ¨ã®å®Ÿè£…çŠ¶æ³

### ğŸ³ Container Orchestration System (Issue #9) - å®Œå…¨å®Ÿè£…æ¸ˆã¿ âœ…

#### ğŸ—ï¸ Kubernetes Native Architecture
- **Monitor Pod**: GitHub Issueç›£è¦–ãƒ»ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³æ¤œçŸ¥
- **Worker Pod**: Issueæ¯ã®ç‹¬ç«‹Podå‹•çš„ä½œæˆãƒ»ç®¡ç†
- **SPDY Executor**: pkg/kubernetes/client.go - Podå†…ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡ŒAPI
- **Pod Lifecycle**: è‡ªå‹•ä½œæˆãƒ»å‰Šé™¤ãƒ»ãƒªã‚½ãƒ¼ã‚¹ç®¡ç†

#### ğŸ” èªè¨¼ã‚·ã‚¹ãƒ†ãƒ  (Issue #16)
- **OAuth Tokenç®¡ç†**: pkg/auth/ - è‡ªå‹•æ›´æ–°ãƒ»æ°¸ç¶šåŒ–
- **Kubernetes Secret**: èªè¨¼æƒ…å ±ã®Secureé…ç½®
- **Template Generation**: ç’°å¢ƒå¤‰æ•°ãƒ™ãƒ¼ã‚¹ã®èªè¨¼ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ
- **Hot Deployment**: Tokenæ›´æ–°æ™‚ã®è‡ªå‹•åæ˜ 

#### ğŸ”§ Claude CLI Containerçµ±åˆ (Issue #13)
- **Real Claude CLI**: Podå†…å®Ÿéš›ã®Claude CLI v1.0.3å®Ÿè¡Œ
- **Advanced Options**: --max-turns, --verbose, --continueå¯¾å¿œ
- **Alpine Linuxäº’æ›**: shebangä¿®æ­£ãƒ»Node.jsç’°å¢ƒæœ€é©åŒ– (Issue #17)
- **Authentication Mount**: èªè¨¼ãƒ•ã‚¡ã‚¤ãƒ«è‡ªå‹•ãƒã‚¦ãƒ³ãƒˆãƒ»æ¤œè¨¼

#### ğŸ§ª End-to-Endçµ±åˆãƒ†ã‚¹ãƒˆ (Issue #14)
- **Integration Tests**: test/integration/ - ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“å‹•ä½œç¢ºèª
- **Container Manager**: pkg/container/manager.go - Podå‹•çš„ç®¡ç†
- **Authentication Tests**: èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ãƒ»K8sçµ±åˆæ¤œè¨¼
- **Production Ready**: minikubeå¯¾å¿œãƒ»Alpine Linuxæœ€é©åŒ–

#### ğŸ” GitHub Issueç›£è¦–ã‚·ã‚¹ãƒ†ãƒ  (Issue #1)
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–**: Monitor Pod ã«ã‚ˆã‚‹30ç§’é–“éš”ãƒãƒ¼ãƒªãƒ³ã‚°
- **ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³æ¤œçŸ¥**: æ­£è¦è¡¨ç¾ã«ã‚ˆã‚‹é«˜ç²¾åº¦@claudeæ¤œå‡º
  ```go
  mentionRegex := regexp.MustCompile(`(?i)(?:^|[^a-zA-Z0-9.])@claude\b`)
  ```
- **APIçµ±åˆ**: GitHub API v4 + OAuth2èªè¨¼

#### âš™ï¸ Container Orchestratorå®Ÿè£…
- **Pod Management**: Kubernetes API ã«ã‚ˆã‚‹å‹•çš„Worker Podä½œæˆãƒ»å‰Šé™¤
- **Claude CLIé«˜åº¦æ©Ÿèƒ½**: Podå†…ã§ã®--max-turns, --verbose, --continueå®Ÿè¡Œ
- **ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†**: æ°¸ç¶šåŒ–ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚ˆã‚‹è¤‡æ•°ã‚¿ãƒ¼ãƒ³å¯¾å¿œ
- **ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ç®¡ç†**: Issueç•ªå·åˆ¥ã®ç‹¬ç«‹ä½œæ¥­é ˜åŸŸ

#### ğŸ¤– è‡ªå‹•å¿œç­”ã‚·ã‚¹ãƒ†ãƒ 
- **é€²æ—å ±å‘Š**: å‡¦ç†é–‹å§‹ãƒ»é€²è¡ŒçŠ¶æ³ã®è‡ªå‹•ã‚³ãƒ¡ãƒ³ãƒˆ
- **çµæœé€šçŸ¥**: Podå®Ÿè¡Œå®Œäº†æ™‚ã®Issueè¿”ä¿¡
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: Podå¤±æ•—æ™‚ã®è©³ç´°ã‚¨ãƒ©ãƒ¼æƒ…å ±è‡ªå‹•å ±å‘Š

### æ¤œè¨¼æ¸ˆã¿æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

#### Claude CLIçµ±åˆ
```bash
# æ¤œè¨¼æ¸ˆã¿ã‚³ãƒãƒ³ãƒ‰ä¾‹
claude --print --max-turns 10 --verbose --output-format json
claude --continue session-file.session --max-turns 5
```

#### MCP ãƒ„ãƒ¼ãƒ«åˆ©ç”¨
- âœ… **TodoWrite/TodoRead**: ã‚¿ã‚¹ã‚¯ç®¡ç†
- âœ… **Read/Write/Edit**: ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œ
- âœ… **Bash**: ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ
- âœ… **Task**: ä¸¦è¡Œå‡¦ç†ãƒ»æ¤œç´¢

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è©³ç´°

### Container Orchestration Pattern (Kubernetes Native)
```
GitHub Issues â†’ Monitor Pod â†’ Worker Pod (K8s) â†’ Claude CLI â†’ Results
     â†“              â†“              â†“                â†“          â†“
  @claude      API Polling    Dynamic Pod       Pod Execution  Comments
  mention      Detection      Creation          (Isolated)     Auto-Post
```

### Container Orchestrationè©³ç´°
```
1. Monitor Pod (æ°¸ç¶šç¨¼åƒ)
   â”œâ”€â”€ GitHub APIç›£è¦– (30ç§’é–“éš”)
   â”œâ”€â”€ @claudeãƒ¡ãƒ³ã‚·ãƒ§ãƒ³æ¤œçŸ¥
   â””â”€â”€ Worker Podä½œæˆæŒ‡ç¤º

2. Worker Pod (Issueæ¯)
   â”œâ”€â”€ å‹•çš„ä½œæˆãƒ»ç‹¬ç«‹å®Ÿè¡Œç’°å¢ƒ
   â”œâ”€â”€ Claude CLI v1.0.3å®Ÿè¡Œ
   â”œâ”€â”€ èªè¨¼ãƒ•ã‚¡ã‚¤ãƒ«è‡ªå‹•ãƒã‚¦ãƒ³ãƒˆ
   â””â”€â”€ ã‚¿ã‚¹ã‚¯å®Œäº†å¾Œè‡ªå‹•å‰Šé™¤

3. Podé–“é€šä¿¡
   â”œâ”€â”€ Kubernetes API
   â”œâ”€â”€ SPDY Executor (ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ)
   â””â”€â”€ Secret Management (èªè¨¼)
```

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 
```
claude-automation/
â”œâ”€â”€ cmd/
â”‚   â”œâ”€â”€ monitor/main.go        # GitHub APIç›£è¦– (Monitor Pod)
â”‚   â”œâ”€â”€ orchestrator/main.go   # ã‚¿ã‚¹ã‚¯å®Ÿè¡Œç®¡ç† (Worker Podåˆ¶å¾¡)
â”‚   â”œâ”€â”€ agent/main.go          # å°†æ¥ã®ã‚³ãƒ³ãƒ†ãƒŠã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆç”¨
â”‚   â””â”€â”€ token-renewal/main.go  # OAuth Tokenè‡ªå‹•æ›´æ–°
â”œâ”€â”€ pkg/
â”‚   â”œâ”€â”€ container/manager.go   # Container Manager (Pod Lifecycle)
â”‚   â”œâ”€â”€ kubernetes/client.go   # Kubernetes Client (SPDY Executor)
â”‚   â””â”€â”€ auth/                  # èªè¨¼ã‚·ã‚¹ãƒ†ãƒ  (Tokenç®¡ç†ãƒ»æ°¸ç¶šåŒ–)
â”œâ”€â”€ docker/
â”‚   â”œâ”€â”€ Dockerfile             # Claude CLIå®Ÿè¡Œç’°å¢ƒ (Alpine Linux)
â”‚   â””â”€â”€ .dockerignore          # Buildæœ€é©åŒ–è¨­å®š
â”œâ”€â”€ deployments/
â”‚   â””â”€â”€ monitor-deployment.yaml # Kubernetes Manifests
â”œâ”€â”€ test/integration/          # End-to-Endçµ±åˆãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ orchestrator/          # Container Orchestrationå‹•ä½œç¢ºèª
â”‚   â”œâ”€â”€ auth/                  # èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ
â”‚   â””â”€â”€ auth-k8s/              # Kubernetesèªè¨¼çµ±åˆãƒ†ã‚¹ãƒˆ
â”œâ”€â”€ workspaces/                # Issueåˆ¥ä½œæ¥­é ˜åŸŸ
â”œâ”€â”€ sessions/                  # Claude CLIã‚»ãƒƒã‚·ãƒ§ãƒ³
â”œâ”€â”€ config/                    # è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â””â”€â”€ repo-mapping.yaml      # ãƒªãƒã‚¸ãƒˆãƒªãƒãƒƒãƒ”ãƒ³ã‚°è¨­å®š
â”œâ”€â”€ docs/                      # æŠ€è¡“æ–‡æ›¸
â”‚   â””â”€â”€ TOKEN-RENEWAL.md       # Tokenæ›´æ–°ã‚·ã‚¹ãƒ†ãƒ ä»•æ§˜
â”œâ”€â”€ scripts/                   # é‹ç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚   â””â”€â”€ token-renewal.sh       # Tokenæ›´æ–°è‡ªå‹•åŒ–
â”œâ”€â”€ docker-compose.yml         # é–‹ç™ºç’°å¢ƒæ§‹ç¯‰
â”œâ”€â”€ entrypoint.sh              # Containerèµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”œâ”€â”€ setup.sh                   # è‡ªå‹•è¨­å®šã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â””â”€â”€ go.mod                     # ä¾å­˜é–¢ä¿‚ç®¡ç†
```

## ğŸ”§ æŠ€è¡“ä»•æ§˜

### ä¾å­˜é–¢ä¿‚
```go
require (
    github.com/google/go-github/v57 v57.0.0
    github.com/joho/godotenv v1.5.1
    golang.org/x/oauth2 v0.30.0
)
```

### ç’°å¢ƒè¦ä»¶
- **Go**: 1.21+
- **minikube**: é–‹ç™ºç’°å¢ƒKubernetesï¼ˆæ¨å¥¨ï¼‰
- **Docker**: Container Image buildç”¨
- **Claude CLI**: v1.0.3 (Containerå†…å®Ÿè¡Œ)
- **GitHub CLI**: èªè¨¼è¨­å®šæ¸ˆã¿
- **èªè¨¼**: GitHub Personal Access Token

### è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
- **`.env`**: GITHUB_TOKENç­‰ã®ç’°å¢ƒå¤‰æ•°
- **`auth/.claude.json`**: Claude CLIè¨­å®š
- **`auth/.credentials.json`**: OAuthèªè¨¼æƒ…å ±

## ğŸš§ èª²é¡Œã¨è§£æ±ºçŠ¶æ³

### âœ… è§£æ±ºæ¸ˆã¿èª²é¡Œ

#### Issue #9: Container Orchestration System - å®Œå…¨è§£æ±º âœ…
- **Sub-issueså…¨å®Œäº†**: #11, #12, #13, #14, #16, #17
- **Docker-in-Dockerå•é¡Œ**: Kubernetes Native Podã¸å®Œå…¨ç§»è¡Œ
- **èªè¨¼çµ±åˆ**: OAuth Tokenè‡ªå‹•ç®¡ç†ãƒ»æ°¸ç¶šåŒ–ã‚·ã‚¹ãƒ†ãƒ 
- **Production Ready**: minikubeå¯¾å¿œãƒ»Alpine Linuxæœ€é©åŒ–

#### Issue #11: Docker-in-Dockeræ¨©é™å•é¡Œè§£æ±º âœ…
- **è§£æ±ºæ–¹æ³•**: Kubernetes Pod Manager (pkg/container/manager.go)
- **çµæœ**: Docker exit status 125å•é¡Œå®Œå…¨è§£æ±º

#### Issue #12: Dockerfile.claudeçµ±åˆ âœ…
- **è§£æ±ºæ–¹æ³•**: Alpine LinuxåŸºç›¤Claude CLIå®Ÿè¡Œç’°å¢ƒ
- **çµæœ**: claude-automation-claude Image (6.7GBæœ€é©åŒ–)

#### Issue #13: å®Ÿéš›ã®Claude CLIçµ±åˆ âœ…
- **è§£æ±ºæ–¹æ³•**: Podå†…å®Ÿè¡Œãƒ»SPDY Executor API
- **çµæœ**: Real Claude CLI v1.0.3 Containerå®Ÿè¡Œ

#### Issue #14: End-to-Endå‹•ä½œç¢ºèª âœ…
- **è§£æ±ºæ–¹æ³•**: Integration Tests (test/integration/)
- **çµæœ**: Container Orchestration Systemå‹•ä½œä¿è¨¼

#### Issue #16: Claude CLIèªè¨¼ã‚·ã‚¹ãƒ†ãƒ  âœ…
- **è§£æ±ºæ–¹æ³•**: pkg/auth/ OAuth Tokenè‡ªå‹•ç®¡ç†
- **çµæœ**: èªè¨¼æ°¸ç¶šåŒ–ãƒ»è‡ªå‹•æ›´æ–°ã‚·ã‚¹ãƒ†ãƒ 

#### Issue #17: Alpine Linuxäº’æ›æ€§ä¿®æ­£ âœ…
- **è§£æ±ºæ–¹æ³•**: shebangä¿®æ­£ãƒ»Node.jsç’°å¢ƒæœ€é©åŒ–
- **çµæœ**: Containerç’°å¢ƒClaude CLIå®‰å®šå®Ÿè¡Œ

#### Issue #2: Claude CLIæ¨©é™ç®¡ç† âœ…
- **è§£æ±ºæ–¹æ³•**: Containerå†…å®Ÿè¡Œãƒ»Podåˆ†é›¢
- **çµæœ**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–ãƒ»æ¨©é™å•é¡Œè§£æ±º

#### Issue #6: Unix Socketé€šä¿¡ âœ…
- **åˆ¤å®š**: ä¸è¦ï¼ˆKubernetes Nativeæ¡ç”¨ï¼‰
- **ç†ç”±**: Podé–“é€šä¿¡ãƒ»Kubernetes APIæ´»ç”¨

### ğŸ”„ é€²è¡Œä¸­ãƒ»è¨ˆç”»ä¸­

#### Issue #3: å‹•çš„ã‚³ãƒ³ãƒ†ãƒŠé¸æŠ
- **å„ªå…ˆåº¦**: ä¸­ï¼ˆKubernetes Nativeå®Ÿè£…æ¸ˆã¿ï¼‰
- **å®Ÿè£…äºˆå®š**: è¨€èªæ¤œå‡ºã«ã‚ˆã‚‹è‡ªå‹•Imageé¸æŠ

#### Issue #4: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–
- **å„ªå…ˆåº¦**: ä¸­
- **å®Ÿè£…äºˆå®š**: Podç›£è¦–ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆæ©Ÿèƒ½

#### Issue #5: LINEé€£æº
- **å„ªå…ˆåº¦**: ä½
- **å®Ÿè£…äºˆå®š**: ãƒ¢ãƒã‚¤ãƒ«ã‹ã‚‰ã®Issueä½œæˆ

## ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™

### Container Orchestration
- **Monitor Pod**: <50MB ãƒ¡ãƒ¢ãƒªãƒ»æ°¸ç¶šç¨¼åƒ
- **Worker Pod**: å‹•çš„ä½œæˆãƒ»Issueæ¯ç‹¬ç«‹å®Ÿè¡Œç’°å¢ƒ
- **Podä½œæˆæ™‚é–“**: <10ç§’ï¼ˆImage Pullæ¸ˆã¿ï¼‰
- **Resource Isolation**: Pod-levelåˆ†é›¢ãƒ»RBACæ¨©é™ç®¡ç†

### Claude CLIå®Ÿè¡Œ
- **Containerèµ·å‹•**: <5ç§’ï¼ˆAlpine Linuxæœ€é©åŒ–ï¼‰
- **èªè¨¼**: è‡ªå‹•ãƒã‚¦ãƒ³ãƒˆãƒ»Tokenç®¡ç†
- **åŒæ™‚å®Ÿè¡Œ**: Issueç•ªå·åˆ¥Podä¸¦è¡Œå‡¦ç†
- **Auto Cleanup**: ã‚¿ã‚¹ã‚¯å®Œäº†æ™‚Podè‡ªå‹•å‰Šé™¤

## ğŸ¯ æ¬¡æœŸé–‹ç™ºãƒ•ã‚§ãƒ¼ã‚º

### Phase 2: Kubernetesæ©Ÿèƒ½æ‹¡å¼µ
1. **Horizontal Pod Autoscaler**: è² è·ãƒ™ãƒ¼ã‚¹Podè‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°
2. **Multi-Cluster**: è¤‡æ•°Kubernetesã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼å¯¾å¿œ
3. **Service Mesh**: Istioçµ±åˆãƒ»ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ç®¡ç†
4. **Webhookå¯¾å¿œ**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å‡¦ç†é«˜é€ŸåŒ–
5. **ãƒãƒ«ãƒãƒªãƒã‚¸ãƒˆãƒª**: è¤‡æ•°ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå¯¾å¿œ

### Phase 3: ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºå¯¾å¿œ
1. **RBACå¼·åŒ–**: Kubernetes ServiceAccountãƒ»Roleç®¡ç†
2. **ç›£æŸ»ãƒ­ã‚°**: Podå®Ÿè¡Œå±¥æ­´ãƒ»Kubernetes Events
3. **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£**: æœ¬æ ¼çš„ãªKubernetesã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼å¯¾å¿œ
4. **ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰**: Kubernetes Dashboardçµ±åˆãƒ»Web UI

## ğŸ› ï¸ é–‹ç™ºãƒ»é‹ç”¨ã‚¬ã‚¤ãƒ‰

### minikubeé–‹ç™ºãƒ•ãƒ­ãƒ¼
1. **minikubeèµ·å‹•**: `minikube start`
2. **Dockerç’°å¢ƒè¨­å®š**: `eval $(minikube docker-env)`
3. **ãƒ–ãƒ©ãƒ³ãƒä½œæˆ**: `git checkout -b feature/task-name`
4. **Imageæ§‹ç¯‰**: `docker build -f docker/Dockerfile -t claude-automation-claude .`
5. **ImageåŒæœŸ**: `minikube image load claude-automation-claude`
6. **ã“ã¾ã‚ãªã‚³ãƒŸãƒƒãƒˆ**: æ©Ÿèƒ½å˜ä½ã§ã®ä¿å­˜
7. **çµ±åˆãƒ†ã‚¹ãƒˆ**: `go run test/integration/orchestrator/main.go`
8. **Podç¢ºèª**: `minikube kubectl -- get pods`
9. **ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—**: ä¸è¦ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»Podå‰Šé™¤
10. **PRä½œæˆ**: ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¾é ¼

### ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ä½œæ¥­
```bash
# minikubeçŠ¶æ³ç¢ºèª
minikube status
minikube kubectl -- get pods --all-namespaces

# Worker Podç¢ºèªãƒ»å‰Šé™¤
minikube kubectl -- get pods -l type=worker
minikube kubectl -- delete pods -l type=worker

# Imageç¢ºèª
minikube image ls | grep claude-automation

# ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèª
find . -name "*test*" -type f

# ä¸è¦ãƒ•ã‚¡ã‚¤ãƒ«ã®æ¤œç´¢
find . -name "*.log" -o -name "*.tmp" -o -name "*~"

# ä¾å­˜é–¢ä¿‚ã®æ•´ç†
go mod tidy
```

### å“è³ªä¿è¨¼
- **é™çš„è§£æ**: `go vet ./...`
- **ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ**: `go fmt ./...`
- **ä¾å­˜é–¢ä¿‚**: `go mod verify`
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: `govulncheck ./...`

## ğŸ“ é‡è¦ãªæ³¨æ„äº‹é …

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- **èªè¨¼ãƒ•ã‚¡ã‚¤ãƒ«**: `.gitignore`ã§é™¤å¤–æ¸ˆã¿
- **ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†**: ç’°å¢ƒå¤‰æ•°ã§ã®ç®¡ç†
- **æ¨©é™æœ€å°åŒ–**: å¿…è¦æœ€å°é™ã®ã‚¹ã‚³ãƒ¼ãƒ—è¨­å®š

### é‹ç”¨
- **ãƒ­ã‚°ç›£è¦–**: ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚°ã®å®šæœŸç¢ºèª
- **ãƒªã‚½ãƒ¼ã‚¹ç®¡ç†**: ãƒ¡ãƒ¢ãƒªãƒ»CPUä½¿ç”¨é‡ç›£è¦–
- **ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—**: è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®å®šæœŸä¿å­˜

### é–‹ç™º
- **ãƒ†ã‚¹ãƒˆå¿…é ˆ**: æ–°æ©Ÿèƒ½ã«ã¯å¿…ãšãƒ†ã‚¹ãƒˆè¿½åŠ 
- **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°**: README.mdãƒ»CLAUDE.mdã®ä¿å®ˆ
- **äº’æ›æ€§**: æ—¢å­˜æ©Ÿèƒ½ã¸ã®å½±éŸ¿è©•ä¾¡

## ğŸ‰ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æˆæœ

### æŠ€è¡“çš„æˆæœ
- âœ… **Container Orchestration**: Kubernetes Native Podç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 
- âœ… **Production Ready**: minikubeå¯¾å¿œãƒ»Alpine Linuxæœ€é©åŒ–
- âœ… **Real Claude CLI**: Podå†…å®Ÿéš›ã®Claude CLI v1.0.3å®Ÿè¡Œ
- âœ… **Authentication System**: OAuth Tokenè‡ªå‹•ç®¡ç†ãƒ»æ°¸ç¶šåŒ–
- âœ… **Security Enhancement**: Podåˆ†é›¢ãƒ»RBACæ¨©é™ç®¡ç†
- âœ… **å®Œå…¨è‡ªå‹•åŒ–**: äººé–“ã®ä»‹å…¥ä¸è¦
- âœ… **é«˜ä¿¡é ¼æ€§**: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ»Integration Testå®Œå‚™
- âœ… **æ‹¡å¼µæ€§**: Kubernetes Nativeãƒ¢ã‚¸ãƒ¥ãƒ©ãƒ¼è¨­è¨ˆ
- âœ… **ä¿å®ˆæ€§**: ã‚¯ãƒªãƒ¼ãƒ³ãªã‚³ãƒ¼ãƒ‰æ§‹é€ ãƒ»æ–‡æ›¸åŒ–
- ğŸ¯ **Docker-in-Dockerå•é¡Œè§£æ±º**: Kubernetes Native Podç®¡ç†ã«ã‚ˆã‚‹æ ¹æœ¬è§£æ±º

### ãƒ“ã‚¸ãƒã‚¹ä¾¡å€¤
- âš¡ **åŠ¹ç‡åŒ–**: æ‰‹å‹•ä½œæ¥­ã®95%å‰Šæ¸›ãƒ»Podè‡ªå‹•ç®¡ç†
- ğŸ”„ **24æ™‚é–“å¯¾å¿œ**: Monitor Podç„¡äººç¶™ç¶šç¨¼åƒ
- ğŸ“ˆ **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£**: Issueæ¯ç‹¬ç«‹Podãƒ»ä¸¦è¡Œå‡¦ç†
- ğŸ›¡ï¸ **ä¿¡é ¼æ€§**: KubernetesåŸºç›¤ãƒ»å®‰å®šã‚µãƒ¼ãƒ“ã‚¹æä¾›
- ğŸ³ **Container Native**: ãƒ¢ãƒ€ãƒ³ãªé–‹ç™ºãƒ»é‹ç”¨åŸºç›¤

---

**Container Orchestration Systemå®Œå…¨å®Ÿè£…ãƒ»æœ¬æ ¼çš„ãªãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³é‹ç”¨æº–å‚™å®Œäº†ï¼** ğŸš€