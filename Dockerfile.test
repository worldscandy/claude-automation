# Test container for running the orchestrator
FROM golang:1.21-alpine

# Install Docker CLI
RUN apk add --no-cache docker-cli

WORKDIR /app

# Copy go files
COPY go.mod go.sum ./
RUN go mod download

COPY . .

# Build
RUN go build -o orchestrator ./cmd/orchestrator
RUN CGO_ENABLED=0 go build -o agent ./cmd/agent

# Create directories
RUN mkdir -p shared/workspaces

CMD ["./orchestrator"]